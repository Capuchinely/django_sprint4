<<<<<<< HEAD
<!-- templates/blog/detail.html -->
{% extends "base.html" %}
{% load thumbnail %}
{% load django_bootstrap5 %}

{% block title %}{{ post.title }} | –ê–Ω—Ñ–∏—Å–∞ –¥–ª—è –¥—Ä—É–∑–µ–π{% endblock %}

{% block content %}
  <div class="container py-5">
    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% bootstrap_messages %}
    
    <!-- –ü–æ—Å—Ç -->
    <article class="card mb-4">
      {% if post.image %}
        <div class="card-img-top">
          {% thumbnail post.image "800" crop="center" as im %}
            <img src="{{ im.url }}" class="img-fluid w-100" alt="{{ post.title }}">
          {% endthumbnail %}
        </div>
      {% endif %}
      <div class="card-body">
        <h1 class="card-title">{{ post.title }}</h1>
        <p class="card-text">{{ post.text|linebreaks }}</p>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <small class="text-muted">
              –ê–≤—Ç–æ—Ä: 
              <a href="{% url 'users:profile' post.author.username %}">
                {{ post.author.username }}
              </a>
              | {{ post.pub_date|date:"d.m.Y H:i" }}
              {% if post.location %}
                | {{ post.location.name }}
              {% endif %}
            </small>
          </div>
          {% if user == post.author %}
            <div>
              <a href="{% url 'blog:post_edit' post.id %}" class="btn btn-sm btn-warning">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
              </a>
              <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" 
                      data-bs-target="#deleteModal">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          {% endif %}
        </div>
      </div>
    </article>
    
    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <section class="mb-4">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments.count }})</h3>
      
      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
      {% if user.is_authenticated %}
        <div class="card mb-3">
          <div class="card-body">
            <form method="post" action="{% url 'blog:add_comment' post.id %}">
              {% csrf_token %}
              {% bootstrap_form comment_form %}
              {% bootstrap_button button_type="submit" content="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" %}
            </form>
          </div>
        </div>
      {% else %}
        <div class="alert alert-info">
          <a href="{% url 'users:login' %}?next={{ request.path }}">–í–æ–π–¥–∏—Ç–µ</a>, 
          —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.
        </div>
      {% endif %}
      
      <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
      {% for comment in comments %}
        <div class="card mb-2">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <strong>{{ comment.author.username }}</strong>
                <small class="text-muted ms-2">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                <p class="mt-2 mb-0">{{ comment.text|linebreaks }}</p>
              </div>
              {% if user == comment.author %}
                <div>
                  <a href="{% url 'blog:edit_comment' post.id comment.id %}" 
                     class="btn btn-sm btn-outline-warning">
                    ‚úèÔ∏è
                  </a>
                  <button type="button" class="btn btn-sm btn-outline-danger" 
                          data-bs-toggle="modal" 
                          data-bs-target="#deleteCommentModal{{ comment.id }}">
                    üóëÔ∏è
                  </button>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
        {% if user == comment.author %}
          <div class="modal fade" id="deleteCommentModal{{ comment.id }}" tabindex="-1">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?</p>
                  <div class="alert alert-warning">
                    {{ comment.text|truncatewords:20 }}
                  </div>
                </div>
                <div class="modal-footer">
                  <form method="post" 
                        action="{% url 'blog:delete_comment' post.id comment.id %}">
                    {% csrf_token %}
                    <button type="button" class="btn btn-secondary" 
                            data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      {% empty %}
        <div class="alert alert-secondary">
          –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!
        </div>
      {% endfor %}
    </section>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–£–¥–∞–ª–µ–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é "{{ post.title }}"?</p>
          <div class="alert alert-danger">
            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
          </div>
        </div>
        <div class="modal-footer">
          <form method="post" action="{% url 'blog:post_delete' post.id %}">
            {% csrf_token %}
            <button type="button" class="btn btn-secondary" 
                    data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
          </form>
        </div>
=======
{% extends "base.html" %}
{% block title %}
  {{ post.title }} | {% if post.location and post.location.is_published %}{{ post.location.name }}{% else %}–ü–ª–∞–Ω–µ—Ç–∞ –ó–µ–º–ª—è{% endif %} |
  {{ post.pub_date|date:"d E Y" }}
{% endblock %}
{% block content %}
  <div class="col d-flex justify-content-center">
    <div class="card" style="width: 40rem;">
      <div class="card-body">
        {% if post.image %}
          <a href="{{ post.image.url }}" target="_blank">
            <img class="border-3 rounded img-fluid img-thumbnail mb-2 mx-auto d-block" src="{{ post.image.url }}">
          </a>
        {% endif %}
        <h5 class="card-title">{{ post.title }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">
          <small>
            {% if not post.is_published %}
              <p class="text-danger">–ü–æ—Å—Ç —Å–Ω—è—Ç —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–º</p>
            {% elif not post.category.is_published %}
              <p class="text-danger">–í—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–Ω—è—Ç–∞ —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–º</p>
            {% endif %}
            {{ post.pub_date|date:"d E Y, H:i" }} | {% if post.location and post.location.is_published %}{{ post.location.name }}{% else %}–ü–ª–∞–Ω–µ—Ç–∞ –ó–µ–º–ª—è{% endif %}<br>
            –û—Ç –∞–≤—Ç–æ—Ä–∞ <a class="text-muted" href="{% url 'blog:profile' post.author.username %}">@{{ post.author.username }}</a> –≤
            –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ {% include "includes/category_link.html" %}
          </small>
        </h6>
        <p class="card-text">{{ post.text|linebreaksbr }}</p>
        {% if user == post.author %}
          <div class="mb-2">
            <a class="btn btn-sm text-muted" href="{% url 'blog:edit_post' post.id %}" role="button">
              –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é
            </a>
            <a class="btn btn-sm text-muted" href="{% url 'blog:delete_post' post.id %}" role="button">
              –£–¥–∞–ª–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é
            </a>
          </div>
        {% endif %}
        {% include "includes/comments.html" %}
>>>>>>> 245849ff9b049ed711f8fe5b0b0d2cbf32ee55fe
      </div>
    </div>
  </div>
{% endblock %}